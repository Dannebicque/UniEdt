{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h1>Programmation</h1>

  <div class="mb-4">
        <form method="post" action="{% url 'programmation:import_previsionnel' %}">
            {% csrf_token %}
            <button type="button" class="btn btn-primary" id="importPrevisionnel">Import du Prévisionnel</button>
        </form>
    </div>

  <div class="card">
    <div class="card-header">
      <h2>Partie 1 - Semestres S1, S3, S5</h2>
    </div>
    <div class="card-body">
      <div class="d-flex flex-wrap gap-2">
        <a href="{% url 'programmation:partie1' %}" class="btn btn-success">Programmation</a>
        <a href="{% url 'programmation:etudiants_1' %}" class="btn btn-info">Synthèse Étudiants</a>
        <a href="{% url 'programmation:profs_1' %}" class="btn btn-secondary">Synthèse Profs</a>
        <a href="{% url 'programmation:export_semaines' %}" class="btn btn-success">Exporter les semaines</a>
      </div>
    </div>
  </div>
</div>


<!-- Modal Résultat Import Prévisionnel -->
<div class="modal fade" id="resultImportModal" tabindex="-1" role="dialog" aria-labelledby="resultImportModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="resultImportModalLabel">Résultat de l'importation</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Fermer">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="resultImportMessage">
        <!-- Le message sera injecté ici -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>

<script>
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Vérifie si ce cookie correspond au nom recherché
            if (cookie.substring(0, name.length + 1) === (name + "=")) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

document.getElementById('importPrevisionnel').addEventListener('click', function() {
  fetch('/programmation/import_previsionnel/', {
    method: "POST",
    headers: {
      "X-CSRFToken": getCookie("csrftoken")
    }
  })
  .then(response => response.json())
  .then(data => {
    document.getElementById('resultImportMessage').innerText = data.message;
    var myModal = new bootstrap.Modal(document.getElementById('resultImportModal'));
    myModal.show();
  })
  .catch(error => {
    console.error(error);
    document.getElementById('resultImportMessage').innerText = "Erreur lors de l'importation.";
    var myModal = new bootstrap.Modal(document.getElementById('resultImportModal'));
    myModal.show();
  });
});


</script>

{% endblock %}
